---
tags:
  - Knowledge
---
## 关系数据结构
### 关系的基本概念
> [!definition] 域 (Domain)
> 域是一组具有相同数据类型的值的集合。

> [!definition] 笛卡尔积 (Cartesian Product)
> 域上的一种集合运算。
> > [!example] 
> > $$
> > \begin{aligned}
> > D_1&=\{\text{张三},\text{李四}\}\\
> > D_2&=\{\text{CS},\text{AI}\}\\\
> > D_3&=\{2021,2022,2023\}
> > \end{aligned}
> > $$
> > 则$D_1,D_2,D_3$的笛卡尔积为
> > $$
> > \begin{aligned}
> > D_1\times D_2\times D_3=\{&(\text{张三},\text{CS},2021),(\text{张三},\text{CS},2022),(\text{张三},\text{CS},2023),\\
> > &(\text{张三},\text{AI},2021),(\text{张三},\text{AI},2022),(\text{张三},\text{AI},2023),\\
> > &(\text{李四},\text{CS},2021),(\text{李四},\text{CS},2022),(\text{李四},\text{CS},2023),\\
> > &(\text{李四},\text{AI},2021),(\text{李四},\text{AI},2022),(\text{李四},\text{AI},2023)\}
> > \end{aligned}
> > $$
> > 其中一个小括号中的内容可以称为一个元组。

> [!definition] 关系 (Relation)
> $D_1× D_2×...× D_n$的*子集*叫作在域$D_1,D_2,...,D_n$上的关系， 表示为$R(D_1,D_2,...,D_n)$，其中$R$是*关系名*，$n$是关系的*目*或*度(Degree)*。关系分为三类：
> - **基本关系**（也称基本表或基表）：是实际存在的表，是实际数据的存储结构；
> - **查询表**：是经过查询操作后得到的结果集；
> - **视图**：视图并不存储实际的数据，只保存查询语句。

> [!definition] 元组 (Tuple)
> 关系中的每个元素是关系中的元组， 通常用$t$表示。

> [!definition] 属性 (Attribute)
> 关系中不同列可以对应相同的域，为了加以区分，必须对每列起一个名字，称为属性。*$n$目关系必有$n$个属性。*

> [!definition] 码 (Key)
> 其引入数据依赖后的数学定义[[关系规范化基础#数据依赖|见此]]
> - **候选码(Candidate Key)**：若关系中的某一*属性组*（不一定只有一个属性）的值能唯一地标识一个元组，而其子集不能，则称该属性组为候选码。此时候选码的各属性则称为*主属性(Prime Attribute)*，其它属性则称*非主属性(Non-key Attribute)*。
> - **全码(All-key)**：最极端的情况下，所有属性组是才是这个关系模式的候选码，此时称为全码。
> - **主码(Primary Key)**：若一个关系中有多个候选码，则选定其中一个为主码（因为候选码可以是一个属性组，因此主码也可以是一个*属性组*）。

> [!caution] 
> 主属性是候选码的属性，而不是主码的属性。
### 基本关系性质
1. 列是同质的(Homogeneous)，即每一列中的分量来自同一个域。
2. 不同的列可来自同一域，由不同的属性名区分。
3. 列的顺序无所谓。
4. 任意两个元组的候选码不能完全相同。
5. 行的顺序无所谓。
6. 每一个分量必须是不可分的数据项，因此有一对行列即可查到唯一的分量，这是规范条件中*最基本*的一条。
### 关系操作
常用关系操作：
- 查询：*选择*、*投影*、连接、除、交、*并*、*差*、*笛卡儿积*（斜体为五种**基本运算**，其它运算可以由基本运算得到）
- 数据更新：插入、删除、修改

关系操作就是集合操作，操作的对象和结果都是集合。
## 关系的完整性
### 实体完整性
**实体完整性规则(Entity Interity)**：*主属性*不能为空。
> [!caution] 
> 注意这里是主属性不能为空，而非只是主码不能为空。
### 参照完整性
**关系间的引用**：如现在有两个关系，学生（学号，姓名，*专业号*），专业（*专业号*，专业名）。学生关系的专业号属性的域被专业关系的专业号属性所限制，此时*学生的专业号引用专业的专业号*。
> [!definition] 外码 (Foreign Key)
> $F$是关系$R$的一个属性组，但不是$R$的主码，但$F$与关系$S$的主码$K$相对应，则称$F$为$R$的外码。此时$R$为**参照关系(Referencing Relation)**，$S$为**被参照关系(Referenced Relation)**或**目标关系(Target Relation)**。
> - $R$和$S$可能是同一个关系；
> - $K$和$F$域相同；
> - $K$和$F$不一定同名，但为了方便识别一般同名。

**参照完整性规则**：还以上面为例，$R$中每个元组在$F$上的值，要不全为空值，要不等于$S$中某元组的主码值。
## 关系代数
### 基本概念
关系代数是一种抽象的查询语言，使用*对关系的运算*来表达查询，其有以下三个要素：
- 运算对象：关系
- 运算结果：关系
- 运算符：集合运算符、关系运算符、算术比较符、逻辑运算符

$t\in R$中$R$为关系，$t$为元组，$t[A_i]$表示元组$t$中对应属性$A_i$的分量；$A=\{A_1,A_2,...,A_n\}$，则$A$为属性组，$\bar{A}$为去掉$\{A_1,A_2,...,A_n\}$剩下的属性组。

> [!definition] 连接
> 设$t_1$为$m$列元组，$t_1$为$n$列元组，则$\overset{\LARGE{\frown}}{t_1 t_2}$表示两元组连接成的$m+n$列的元组，称为元组的连接；

> [!definition] 象集 (Image Set)
> 设$X,Z$为$R$的属性组，当$t[X]=x$时，记$x$在$R$上的象集为
> $$Z_x=\{t[Z]|t\in R,t[X]=x\}$$
> 表示$R$的属性组$X$取值为$x$的元组，在属性组$Z$上取值的集合。
### 关系间的运算
#### 集合运算符
- **并(Union)**、**差(Difference)**、**交(Intersection)**三种运算都与集合运算相同，运算的对象为*目相同*的两个关系，不再赘述；
- **广义笛卡尔积(Extended Cartesian Product)**：即将一个关系中的所有元组，与另一个关系中的所有元组一一进行连接，设$m$目关系$R$有$k_1$个元组，$n$目关系$S$有$k_2$个元组，则$R\times S$为一个$m+n$目，$k_1\cdot k_2$元组的关系。
> [!caution] 注*
> 广义笛卡尔积也需要写连接条件。
#### 专门的关系运算
1. **选择(Selection)**：也称限制(Restriction)，即在关系$R$中选择满足给定条件的各元组，表示为
	$$\sigma_F(R)=\{t|t\in R\ \wedge\ F(t)\}$$
	其中$F$为选择条件，是一个逻辑表达式。
1. **投影(Projection)**：在$R$中选择出某些属性列组成新的关系，表示为$$\pi_A(R)=\{t[A]|t\in R\}$$
> [!caution] 
> 投影操作后会自动清除重复的元组。
1. **连接(Join)**：也称为$\theta$连接，即从两个关系的笛卡尔积中选择属性组满足一定条件的元组，表示为
	$$R\Join_{A\theta B}S=\{\overset{\LARGE{\frown}}{t_R t_S}|t_R\in R\ \wedge\ t_S\in S\ \wedge\ t_R[A]\theta t_S[B]\}$$
	其中$A,B$需要是$R$和$S$上可比的属性组，$\theta$为比较运算符。两种常用连接：
	- **等值连接(Equijoin)**：即$\theta$为$=$的连接运算；
	- **自然连接(Natural Join)**：即当$R$与$S$中有相同的属性组时，将$R\times S$中重复的属性组去掉，直接记作$R\Join S$。
	
	由于选择与投影运算的时间复杂度为$O(n)$，而连接运算为$O(m\times n)$，因此一般按照*选择-投影-连接*的顺序运算。
	> [!caution] 
	> 在这种连接两个表格的操作中，*只有自然连接不需要写连接条件*，等值连接、广义笛卡尔积都需要写连接条件。
1. **除(Division)**：设$R(X,Y),S(Y,Z)$，其中$X,Y,Z$均为属性组，$R\div S$即求$X$上哪些值所对应的象集，能包含$S$中$Y$上的所有的取值，结果即为$R$中的这些值。具体可见以下实例： #Missing
	![[Pasted image 20240302202925.png]]
	![[Pasted image 20240302202939.png]]